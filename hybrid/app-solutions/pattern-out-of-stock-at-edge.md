---
title: Azure と Azure Stack Edge を使用した在庫切れ検出
description: Azure と Azure Stack Edge サービスを使用して、在庫切れの検出を実装する方法について説明します。
author: BryanLa
ms.topic: article
ms.date: 11/05/2019
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 11/05/2019
ms.openlocfilehash: 865f63bc4234e50ed169aa29cefdb1886750594c
ms.sourcegitcommit: bb3e40b210f86173568a47ba18c3cc50d4a40607
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/17/2020
ms.locfileid: "84911189"
---
# <a name="out-of-stock-detection-at-the-edge-pattern"></a><span data-ttu-id="89711-103">エッジ パターンでの在庫切れ検出</span><span class="sxs-lookup"><span data-stu-id="89711-103">Out of stock detection at the edge pattern</span></span>

<span data-ttu-id="89711-104">このパターンは、Azure Stack Edge または Azure IoT Edge デバイスとネットワーク カメラを使用して、棚に在庫切れの商品がないかどうかを確認する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="89711-104">This pattern illustrates how to determine if shelves have out of stock items using an Azure Stack Edge or Azure IoT Edge device and network cameras.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="89711-105">コンテキストと問題</span><span class="sxs-lookup"><span data-stu-id="89711-105">Context and problem</span></span>

<span data-ttu-id="89711-106">顧客が商品を探しているときにその商品が棚にしないという理由で、実際の小売店では売上が失われます。</span><span class="sxs-lookup"><span data-stu-id="89711-106">Physical retail stores lose sales because when customers look for an item, it's not present on the shelf.</span></span> <span data-ttu-id="89711-107">しかし、商品は店の奥にあって、補充されていない場合があります。</span><span class="sxs-lookup"><span data-stu-id="89711-107">However, the item could have been in the back of the store and not been restocked.</span></span> <span data-ttu-id="89711-108">店舗では、スタッフをより効率的に利用して、商品の補充が必要になったときに自動的に通知を受け取れるようにしたいと考えています。</span><span class="sxs-lookup"><span data-stu-id="89711-108">Stores would like to use their staff more efficiently and get automatically notified when items need restocking.</span></span>

## <a name="solution"></a><span data-ttu-id="89711-109">解決策</span><span class="sxs-lookup"><span data-stu-id="89711-109">Solution</span></span>

<span data-ttu-id="89711-110">このソリューションの例では、各店舗の Azure Stack Edge などのエッジ デバイスを使用して、店内のカメラからのデータを効率的に処理します。</span><span class="sxs-lookup"><span data-stu-id="89711-110">The solution example uses an edge device, like an Azure Stack Edge in each store, which efficiently processes data from cameras in the store.</span></span> <span data-ttu-id="89711-111">この最適化された設計により、店舗は関連するイベントや画像のみをクラウドに送信できます。</span><span class="sxs-lookup"><span data-stu-id="89711-111">This optimized design lets stores send only relevant events and images to the cloud.</span></span> <span data-ttu-id="89711-112">この設計によって、帯域幅とストレージ領域が節約され、顧客のプライバシーが確保されます。</span><span class="sxs-lookup"><span data-stu-id="89711-112">The design saves bandwidth, storage space, and ensures customer privacy.</span></span> <span data-ttu-id="89711-113">各カメラからフレームが読み込まれると、ML モデルによって画像が処理され、在庫切れの領域があれば返されます。</span><span class="sxs-lookup"><span data-stu-id="89711-113">As frames are read from each camera, an ML model processes the image and returns any out of stock areas.</span></span> <span data-ttu-id="89711-114">画像および在庫切れの領域がローカル Web アプリに表示されます。</span><span class="sxs-lookup"><span data-stu-id="89711-114">The image and out of stock areas are displayed on a local web app.</span></span> <span data-ttu-id="89711-115">このデータを Time Series Insight 環境に送信して、Power BI で分析情報を表示することができます。</span><span class="sxs-lookup"><span data-stu-id="89711-115">This data can be sent to a Time Series Insight environment to show insights in Power BI.</span></span>

![エッジでの在庫切れのソリューション アーキテクチャ](media/pattern-out-of-stock-at-edge/solution-architecture.png)

<span data-ttu-id="89711-117">このソリューションのしくみを次に示します。</span><span class="sxs-lookup"><span data-stu-id="89711-117">Here's how the solution works:</span></span>

1. <span data-ttu-id="89711-118">画像は、HTTP または RTSP 経由でネットワーク カメラからキャプチャされます。</span><span class="sxs-lookup"><span data-stu-id="89711-118">Images are captured from a network camera over HTTP or RTSP.</span></span>
2. <span data-ttu-id="89711-119">画像のサイズが変更され、推論ドライバーに送信されます。このドライバーでは、ML モデルと通信して、在庫切れの画像があるかどうかが判断されます。</span><span class="sxs-lookup"><span data-stu-id="89711-119">The image is resized and sent to the inference driver, which communicates with the ML model to determine if there are any out of stock images.</span></span>
3. <span data-ttu-id="89711-120">ML モデルにより在庫切れの領域が返されます。</span><span class="sxs-lookup"><span data-stu-id="89711-120">The ML model returns any out of stock areas.</span></span>
4. <span data-ttu-id="89711-121">推論ドライバーによって未加工の画像が BLOB にアップロードされ (指定されている場合)、モデルからの結果が Azure IoT Hub とデバイスの境界ボックス プロセッサに送信されます。</span><span class="sxs-lookup"><span data-stu-id="89711-121">The inferencing driver uploads the raw image to a blob (if specified), and sends the results from the model to Azure IoT Hub and a bounding box processor on the device.</span></span>
5. <span data-ttu-id="89711-122">境界ボックス プロセッサにより、境界ボックスが画像に追加され、画像パスがメモリ内データベースにキャッシュされます。</span><span class="sxs-lookup"><span data-stu-id="89711-122">The bounding box processor adds bounding boxes to the image and caches the image path in an in-memory database.</span></span>
6. <span data-ttu-id="89711-123">Web アプリによって画像が照会され、それらが受信された順に表示されます。</span><span class="sxs-lookup"><span data-stu-id="89711-123">The web app queries for images and shows them in the order received.</span></span>
7. <span data-ttu-id="89711-124">IoT Hub からのメッセージは Time Series Insights に集約されます。</span><span class="sxs-lookup"><span data-stu-id="89711-124">Messages from IoT Hub are aggregated in Time Series Insights.</span></span>
8. <span data-ttu-id="89711-125">Power BI には、Time Series Insights のデータと共に、長期間にわたる在庫切れ商品の対話型レポートが表示されます。</span><span class="sxs-lookup"><span data-stu-id="89711-125">Power BI displays an interactive report of out of stock items over time with the data from Time Series Insights.</span></span>


## <a name="components"></a><span data-ttu-id="89711-126">Components</span><span class="sxs-lookup"><span data-stu-id="89711-126">Components</span></span>

<span data-ttu-id="89711-127">このソリューションでは、次のコンポーネントを使用します。</span><span class="sxs-lookup"><span data-stu-id="89711-127">This solution uses the following components:</span></span>

| <span data-ttu-id="89711-128">レイヤー</span><span class="sxs-lookup"><span data-stu-id="89711-128">Layer</span></span> | <span data-ttu-id="89711-129">コンポーネント</span><span class="sxs-lookup"><span data-stu-id="89711-129">Component</span></span> | <span data-ttu-id="89711-130">説明</span><span class="sxs-lookup"><span data-stu-id="89711-130">Description</span></span> |
|----------|-----------|-------------|
| <span data-ttu-id="89711-131">オンプレミスのハードウェア</span><span class="sxs-lookup"><span data-stu-id="89711-131">On-premises hardware</span></span> | <span data-ttu-id="89711-132">ネットワーク カメラ</span><span class="sxs-lookup"><span data-stu-id="89711-132">Network camera</span></span> | <span data-ttu-id="89711-133">ネットワーク カメラは、推論用の画像を提供するため、HTTP または RTSP フィードで必要です。</span><span class="sxs-lookup"><span data-stu-id="89711-133">A network camera is required, with either an HTTP or RTSP feed to provide the images for inference.</span></span> |
| <span data-ttu-id="89711-134">Azure</span><span class="sxs-lookup"><span data-stu-id="89711-134">Azure</span></span> | <span data-ttu-id="89711-135">Azure IoT Hub</span><span class="sxs-lookup"><span data-stu-id="89711-135">Azure IoT Hub</span></span> | <span data-ttu-id="89711-136">[Azure IoT Hub](/azure/iot-hub/) では、デバイス プロビジョニングおよびエッジ デバイスのメッセージングが処理されます。</span><span class="sxs-lookup"><span data-stu-id="89711-136">[Azure IoT Hub](/azure/iot-hub/) handles device provisioning and messaging for the edge devices.</span></span> |
|  | <span data-ttu-id="89711-137">Azure Time Series Insights</span><span class="sxs-lookup"><span data-stu-id="89711-137">Azure Time Series Insights</span></span> | <span data-ttu-id="89711-138">[Azure Time Series Insights](/azure/time-series-insights/) により、視覚化のために IoT Hub からのメッセージが格納されます。</span><span class="sxs-lookup"><span data-stu-id="89711-138">[Azure Time Series Insights](/azure/time-series-insights/) stores the messages from IoT Hub for visualization.</span></span> |
|  | <span data-ttu-id="89711-139">Power BI</span><span class="sxs-lookup"><span data-stu-id="89711-139">Power BI</span></span> | <span data-ttu-id="89711-140">[Microsoft Power BI](https://powerbi.microsoft.com/) では、ビジネスに重点を置いた在庫切れイベントのレポートが提供されます。</span><span class="sxs-lookup"><span data-stu-id="89711-140">[Microsoft Power BI](https://powerbi.microsoft.com/) provides business-focused reports of out of stock events.</span></span> <span data-ttu-id="89711-141">Power BI には、Azure Stream Analytics からの出力を表示するための、使いやすいダッシュボード インターフェイスが用意されています。</span><span class="sxs-lookup"><span data-stu-id="89711-141">Power BI provides an easy-to-use dashboard interface for viewing the output from Azure Stream Analytics.</span></span> |
| <span data-ttu-id="89711-142">Azure Stack Edge または</span><span class="sxs-lookup"><span data-stu-id="89711-142">Azure Stack Edge or</span></span><br><span data-ttu-id="89711-143">Azure IoT Edge デバイス</span><span class="sxs-lookup"><span data-stu-id="89711-143">Azure IoT Edge device</span></span> | <span data-ttu-id="89711-144">Azure IoT Edge</span><span class="sxs-lookup"><span data-stu-id="89711-144">Azure IoT Edge</span></span> | <span data-ttu-id="89711-145">[Azure IoT Edge](/azure/iot-edge/) では、オンプレミスのコンテナーのランタイムが調整され、デバイスの管理と更新が処理されます。</span><span class="sxs-lookup"><span data-stu-id="89711-145">[Azure IoT Edge](/azure/iot-edge/) orchestrates the runtime for the on-premises containers and handles device management and updates.</span></span>|
| | <span data-ttu-id="89711-146">Azure Project Brainwave</span><span class="sxs-lookup"><span data-stu-id="89711-146">Azure project brainwave</span></span> | <span data-ttu-id="89711-147">Azure Stack Edge デバイスでは、ML 推論を高速化するため、[Project Brainwave](https://blogs.microsoft.com/ai/build-2018-project-brainwave/) で Field-Programmable Gate Arrays (FPGA) が使用されます。</span><span class="sxs-lookup"><span data-stu-id="89711-147">On an Azure Stack Edge device, [Project Brainwave](https://blogs.microsoft.com/ai/build-2018-project-brainwave/) uses Field-Programmable Gate Arrays (FPGAs) to accelerate ML inferencing.</span></span>|

## <a name="issues-and-considerations"></a><span data-ttu-id="89711-148">問題と注意事項</span><span class="sxs-lookup"><span data-stu-id="89711-148">Issues and considerations</span></span>

<span data-ttu-id="89711-149">このソリューションの実装方法を決めるときには、以下の点を考慮してください。</span><span class="sxs-lookup"><span data-stu-id="89711-149">Consider the following points when deciding how to implement this solution:</span></span>

### <a name="scalability"></a><span data-ttu-id="89711-150">スケーラビリティ</span><span class="sxs-lookup"><span data-stu-id="89711-150">Scalability</span></span>

<span data-ttu-id="89711-151">ほとんどの機械学習モデルでは、指定されたハードウェアに応じて、1 秒あたり一定のフレーム数でのみ実行できます。</span><span class="sxs-lookup"><span data-stu-id="89711-151">Most machine learning models can only run at a certain number of frames per second, depending on the provided hardware.</span></span> <span data-ttu-id="89711-152">ML パイプラインでバックアップが行われないようにするには、ご使用のカメラから最適なサンプル レートを判断します。</span><span class="sxs-lookup"><span data-stu-id="89711-152">Determine the optimal sample rate from your camera(s) to ensure that the ML pipeline doesn't back up.</span></span> <span data-ttu-id="89711-153">ハードウェアの種類によって、処理するカメラの数とフレーム レートが異なります。</span><span class="sxs-lookup"><span data-stu-id="89711-153">Different types of hardware will handle different numbers of cameras and frame rates.</span></span>

### <a name="availability"></a><span data-ttu-id="89711-154">可用性</span><span class="sxs-lookup"><span data-stu-id="89711-154">Availability</span></span>

<span data-ttu-id="89711-155">エッジ デバイスで接続が失われた場合に何が発生する可能性があるかを考慮することが重要です。</span><span class="sxs-lookup"><span data-stu-id="89711-155">It's important to consider what might happen if the edge device loses connectivity.</span></span> <span data-ttu-id="89711-156">Time Series Insights と Power BI ダッシュボードから失われる可能性があるデータについて考慮してください。</span><span class="sxs-lookup"><span data-stu-id="89711-156">Consider what data might be lost from the Time Series Insights and Power BI dashboard.</span></span> <span data-ttu-id="89711-157">提供されているソリューションの例は、高可用性を実現するように設計されていません。</span><span class="sxs-lookup"><span data-stu-id="89711-157">The example solution as provided isn't designed to be highly available.</span></span>

### <a name="manageability"></a><span data-ttu-id="89711-158">管理の容易性</span><span class="sxs-lookup"><span data-stu-id="89711-158">Manageability</span></span>

<span data-ttu-id="89711-159">このソリューションは多数のデバイスと場所にまたがることがあるため、扱いにくくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="89711-159">This solution can span many devices and locations, which could get unwieldy.</span></span> <span data-ttu-id="89711-160">Azure の IoT サービスにより、新しい場所とデバイスを自動的にオンラインにし、最新の状態に保つことができます。</span><span class="sxs-lookup"><span data-stu-id="89711-160">Azure's IoT services can automatically bring new locations and devices online and keep them up to date.</span></span> <span data-ttu-id="89711-161">適切なデータ ガバナンス手順にも従う必要があります。</span><span class="sxs-lookup"><span data-stu-id="89711-161">Proper data governance procedures must be followed as well.</span></span>

### <a name="security"></a><span data-ttu-id="89711-162">Security</span><span class="sxs-lookup"><span data-stu-id="89711-162">Security</span></span>

<span data-ttu-id="89711-163">このパターンでは、潜在的に敏感なデータが処理されます。</span><span class="sxs-lookup"><span data-stu-id="89711-163">This pattern handles potentially sensitive data.</span></span> <span data-ttu-id="89711-164">キーが定期的にローテーションされており、Azure Storage アカウントとローカル共有のアクセス許可が正しく設定されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="89711-164">Make sure keys are regularly rotated and the permissions on the Azure Storage Account and local shares are correctly set.</span></span>

## <a name="next-steps"></a><span data-ttu-id="89711-165">次のステップ</span><span class="sxs-lookup"><span data-stu-id="89711-165">Next steps</span></span>

<span data-ttu-id="89711-166">この記事で紹介したトピックの関連情報:</span><span class="sxs-lookup"><span data-stu-id="89711-166">To learn more about topics introduced in this article:</span></span>
- <span data-ttu-id="89711-167">このパターンでは、[Azure IoT Edge](/azure/iot-edge/)、[Azure IoT Hub](/azure/iot-hub/)、[Azure Time Series Insights](/azure/time-series-insights/) など、複数の IoT 関連サービスが使用されます。</span><span class="sxs-lookup"><span data-stu-id="89711-167">Multiple IoT related services are used in this pattern, including [Azure IoT Edge](/azure/iot-edge/), [Azure IoT Hub](/azure/iot-hub/), and [Azure Time Series Insights](/azure/time-series-insights/).</span></span>
- <span data-ttu-id="89711-168">Microsoft Project Brainwave の詳細については、[ブログの発表](https://blogs.microsoft.com/ai/build-2018-project-brainwave/)を参照してください。また、[Azure Accelerated Machine Learning with Project Brainwave (Project Brainwave による Azure Machine Learning の高速化) のビデオ](https://www.youtube.com/watch?v=DJfMobMjCX0)をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="89711-168">To learn more about Microsoft Project Brainwave, see [the blog announcement](https://blogs.microsoft.com/ai/build-2018-project-brainwave/) and checkout out the [Azure Accelerated Machine Learning with Project Brainwave video](https://www.youtube.com/watch?v=DJfMobMjCX0).</span></span>
- <span data-ttu-id="89711-169">ベスト プラクティスの詳細とその他の疑問の回答を得るには、「[ハイブリッド アプリケーション設計に関する考慮事項](overview-app-design-considerations.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="89711-169">See [Hybrid app design considerations](overview-app-design-considerations.md) to learn more about best practices and to get answers to any additional questions.</span></span>
- <span data-ttu-id="89711-170">製品とソリューションのポートフォリオ全体の詳細について、[Azure Stack ファミリの製品とソリューション](/azure-stack)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="89711-170">See the [Azure Stack family of products and solutions](/azure-stack) to learn more about the entire portfolio of products and solutions.</span></span>

<span data-ttu-id="89711-171">ソリューションの例をテストする準備ができたら、[分析ソリューションの階層化データのデプロイ ガイド](https://aka.ms/edgeinferencingdeploy)に進んでください。</span><span class="sxs-lookup"><span data-stu-id="89711-171">When you're ready to test the solution example, continue with the [Tiered data for analytics solution deployment guide](https://aka.ms/edgeinferencingdeploy).</span></span> <span data-ttu-id="89711-172">デプロイ ガイドでは、コンポーネントをデプロイしてテストするための詳細な手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="89711-172">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>
